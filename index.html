<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Depo Stok</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --muted:#93a4c7; --text:#e9eeff;
      --line:#22305a; --good:#2dd4bf; --warn:#fbbf24; --bad:#fb7185;
      --btn:#1f2a4d; --btn2:#2a3a6b; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #22305a 0%, transparent 55%),
                  radial-gradient(900px 500px at 95% 10%, #1c3d7a 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      padding:24px;
    }
    .wrap{max-width:1100px; margin:0 auto;}
    header{
      display:flex; gap:14px; align-items:flex-end; justify-content:space-between;
      flex-wrap:wrap; margin-bottom:16px;
    }
    h1{font-size:22px; margin:0; letter-spacing:.2px;}
    .sub{color:var(--muted); font-size:13px; margin-top:4px}
    .grid{
      display:grid; grid-template-columns: 360px 1fr; gap:16px;
    }
    @media (max-width: 900px){ .grid{grid-template-columns:1fr;} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(147,164,199,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
      overflow:hidden;
    }
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(147,164,199,.22);
      background: rgba(18,26,51,.55);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(45,212,191,.55); box-shadow:0 0 0 3px rgba(45,212,191,.12)}
    .row{display:flex; gap:10px}
    .row > *{flex:1}
    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:1px solid rgba(147,164,199,.25);
      background: var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
      transition:.15s transform, .15s background, .15s border;
      user-select:none;
    }
    button:hover{background:var(--btn2)}
    button:active{transform: translateY(1px)}
    .primary{border-color: rgba(45,212,191,.5); background: rgba(45,212,191,.12)}
    .danger{border-color: rgba(251,113,133,.55); background: rgba(251,113,133,.12)}
    .ghost{background: transparent}
    .tiny{padding:7px 9px; border-radius:10px; font-size:12px}
    .tools{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .tools .left{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pill{
      display:flex; gap:10px; align-items:center; padding:8px 10px;
      border:1px solid rgba(147,164,199,.22);
      border-radius:999px;
      background: rgba(18,26,51,.4);
      color: var(--muted);
      font-size:12px;
    }
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:14px}
    thead th{
      text-align:left; font-size:12px; color:var(--muted);
      padding:10px 10px; border-bottom:1px solid rgba(147,164,199,.18);
    }
    tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(147,164,199,.12);
      vertical-align:middle;
    }
    tbody tr:hover{background: rgba(147,164,199,.06)}
    .right{display:flex; gap:6px; justify-content:flex-end; flex-wrap:wrap}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:5px 8px; border-radius:999px; font-size:12px; font-weight:700;
      border:1px solid rgba(147,164,199,.22);
      background: rgba(18,26,51,.45);
    }
    .dot{width:8px; height:8px; border-radius:999px; background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .muted{color:var(--muted)}
    .footerNote{margin-top:10px; font-size:12px; color:var(--muted); line-height:1.35}
    .toast{
      position: fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background: rgba(18,26,51,.92);
      border:1px solid rgba(147,164,199,.22);
      color: var(--text);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      font-size: 13px;
      opacity: 0; pointer-events:none;
      transition: .18s opacity, .18s transform;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
    .kpi{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
    }
    .kpi .box{
      flex:1; min-width:120px;
      border:1px solid rgba(147,164,199,.18);
      background: rgba(18,26,51,.35);
      border-radius: 14px;
      padding:10px 12px;
    }
    .kpi .num{font-size:18px; font-weight:800}
    .kpi .lbl{font-size:12px; color:var(--muted); margin-top:2px}
    .sep{height:1px; background: rgba(147,164,199,.15); margin:12px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Depo Stok</h1>
        <div class="sub">Tarayƒ±cƒ± i√ßinde √ßalƒ±≈üan mini stok uygulamasƒ± (localStorage)</div>
      </div>
      <div class="pill" id="clock">üïí</div>
    </header>

    <div class="grid">
      <!-- LEFT: Form -->
      <section class="card">
        <div class="badge"><span class="dot" id="statusDot"></span><span id="modeText">Yeni √ºr√ºn ekle</span></div>

        <label>√úr√ºn Adƒ±</label>
        <input id="name" placeholder="√ñrn: 10mm Halat" autocomplete="off" />

        <div class="row">
          <div>
            <label>Adet</label>
            <input id="qty" type="number" inputmode="numeric" min="0" placeholder="0" />
          </div>
          <div>
            <label>D√º≈ü√ºk Stok E≈üiƒüi</label>
            <input id="threshold" type="number" inputmode="numeric" min="0" placeholder="√ñrn: 5" />
          </div>
        </div>

        <label>Not (opsiyonel)</label>
        <input id="note" placeholder="√ñrn: Raf A3" autocomplete="off" />

        <div class="btnrow">
          <button class="primary" id="saveBtn">Kaydet</button>
          <button class="ghost" id="resetBtn">Temizle</button>
          <button class="danger" id="deleteBtn" style="display:none;">Sil</button>
        </div>

        <div class="sep"></div>

        <div class="btnrow">
          <button id="exportBtn">CSV Dƒ±≈üa Aktar</button>
          <button id="importBtn">CSV ƒ∞√ße Aktar</button>
          <input id="fileInput" type="file" accept=".csv,text/csv" style="display:none;" />
          <button class="danger" id="wipeBtn">T√ºm√ºn√º Sƒ±fƒ±rla</button>
        </div>

        <div class="footerNote">
          ƒ∞pucu: Listeden bir √ºr√ºne tƒ±klarsan d√ºzenleme moduna ge√ßer. ‚Äú+1 / -1‚Äù ile hƒ±zlƒ± sayƒ±m.
        </div>

        <div class="kpi" id="kpis"></div>
      </section>

      <!-- RIGHT: Table -->
      <section class="card">
        <div class="tools">
          <div class="left">
            <input id="search" placeholder="Ara: √ºr√ºn adƒ± / not" style="width:260px" />
            <select id="sort" style="width:200px">
              <option value="name_asc">Sƒ±rala: Ada g√∂re (A‚ÜíZ)</option>
              <option value="name_desc">Sƒ±rala: Ada g√∂re (Z‚ÜíA)</option>
              <option value="qty_desc">Sƒ±rala: Adet (√ßok‚Üíaz)</option>
              <option value="qty_asc">Sƒ±rala: Adet (az‚Üí√ßok)</option>
              <option value="updated_desc">Sƒ±rala: Son g√ºncellenen</option>
              <option value="created_desc">Sƒ±rala: Son eklenen</option>
            </select>
            <label class="pill" style="cursor:pointer;">
              <input id="onlyLow" type="checkbox" style="width:auto; margin:0 6px 0 0; accent-color: var(--good);" />
              Sadece d√º≈ü√ºk stok
            </label>
          </div>
          <div class="pill" id="countPill">0 √ºr√ºn</div>
        </div>

        <div style="overflow:auto; border-radius:14px; border:1px solid rgba(147,164,199,.12);">
          <table>
            <thead>
              <tr>
                <th style="min-width:220px;">√úr√ºn</th>
                <th style="width:110px;">Adet</th>
                <th style="min-width:180px;">Not</th>
                <th style="width:150px;">Durum</th>
                <th style="width:220px; text-align:right;">ƒ∞≈ülem</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="footerNote">
          Veriler bu cihazda saklanƒ±r. Ba≈üka cihazda kullanmak i√ßin CSV dƒ±≈üa aktarƒ±p i√ße aktarabilirsin.
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {
    getFirestore, collection, doc,
    setDoc, updateDoc, deleteDoc,
    onSnapshot, query, orderBy, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // üî• BURAYA KENDƒ∞ firebaseConfig'ƒ∞Nƒ∞ YAPI≈ûTIR
  const firebaseConfig = {
    apiKey: "BURAYA",
    authDomain: "BURAYA",
    projectId: "BURAYA",
    storageBucket: "BURAYA",
    messagingSenderId: "BURAYA",
    appId: "BURAYA"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const itemsCol = collection(db, "items");

  const $ = s => document.querySelector(s);
  const nameEl = $("#name");
  const qtyEl = $("#qty");
  const thresholdEl = $("#threshold");
  const noteEl = $("#note");
  const tbody = $("#tbody");

  let items = [];
  let selectedId = null;

  // üîÑ CANLI SENKRON (3 Kƒ∞≈ûƒ∞ AYNI ANDA)
  const q = query(itemsCol, orderBy("updatedAt", "desc"));
  onSnapshot(q, snap => {
    items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    render();
  });

  function render(){
    tbody.innerHTML = "";
    items.forEach(it=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${it.name}</td>
        <td>${it.qty}</td>
        <td>
          <button onclick="changeQty('${it.id}',1)">+1</button>
          <button onclick="changeQty('${it.id}',-1)">-1</button>
          <button onclick="editItem('${it.id}')">Edit</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.upsert = async function(){
    const name = nameEl.value.trim();
    if(!name) return alert("√úr√ºn adƒ± bo≈ü");

    const data = {
      name,
      qty: Number(qtyEl.value||0),
      threshold: Number(thresholdEl.value||0),
      note: noteEl.value||"",
      updatedAt: serverTimestamp()
    };

    if(selectedId){
      await updateDoc(doc(db,"items",selectedId), data);
    }else{
      const ref = doc(itemsCol);
      await setDoc(ref, { ...data, createdAt: serverTimestamp() });
    }
    clearForm();
  }

  window.changeQty = async function(id,delta){
    const it = items.find(x=>x.id===id);
    if(!it) return;
    await updateDoc(doc(db,"items",id),{
      qty: Math.max(0,(it.qty||0)+delta),
      updatedAt: serverTimestamp()
    });
  }

  window.editItem = function(id){
    const it = items.find(x=>x.id===id);
    if(!it) return;
    selectedId = id;
    nameEl.value = it.name;
    qtyEl.value = it.qty;
    thresholdEl.value = it.threshold||0;
    noteEl.value = it.note||"";
  }

  function clearForm(){
    selectedId = null;
    nameEl.value = "";
    qtyEl.value = "";
    thresholdEl.value = "";
    noteEl.value = "";
  }
</script>
</body>
</html>


